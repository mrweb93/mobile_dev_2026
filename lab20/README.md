# Лабораторная работа №20
## Финальная доработка приложения. Создание иконки приложения. Подготовка к публикации

**Длительность:** 1 час 30 минут  
**Цель работы:** Научиться создавать адаптивную иконку приложения, добавлять экран-заставку (splash screen), правильно настраивать версионирование и собирать подписанный APK или App Bundle для публикации в магазине приложений.

---

## 1. Теоретическая справка

### 1.1. Иконки приложения в Android
Иконка приложения — это первое, что видит пользователь в меню устройств и в магазине приложений. Android поддерживает два типа иконок:

- **Адаптивная иконка (Adaptive Icon)** – появилась в Android 8.0 (API 26). Состоит из двух слоёв: переднего плана (foreground) и фона (background), которые могут быть обрезаны разными масками (круг, квадрат, скруглённый квадрат) в зависимости от производителя устройства.
- **Устаревшие (legacy) иконки** – для старых версий Android используются обычные PNG-изображения разных размеров (mdpi, hdpi, xhdpi и т.д.).

При создании проекта Android Studio автоматически генерирует набор иконок в папке `res/mipmap`, но их можно заменить через **Image Asset Studio**.

### 1.2. Создание иконки с помощью Image Asset Studio
В Android Studio есть встроенный инструмент для создания иконок: `File -> New -> Image Asset`. Он позволяет:
- Выбрать тип иконки (Launcher Icons – адаптивные, legacy).
- Загрузить изображение (PNG, SVG, PSD) или использовать текст/клипарт.
- Настроить слои, размеры, цвет фона.
- Автоматически сгенерировать все необходимые размеры для разных плотностей экрана.

### 1.3. Экран-заставка (Splash Screen)
Начиная с Android 12, Google рекомендует использовать новый API `SplashScreen`, который обеспечивает единообразный запуск приложения. Для более старых версий можно создать собственную Activity-заставку.

В рамках этой лабораторной работы мы реализуем простой splash screen, совместимый со всеми версиями, с использованием отдельной `SplashActivity`.

### 1.4. Версионирование приложения
В файле `build.gradle.kts` (Module) есть два важных параметра:
- `versionCode` – целое число, внутренний номер версии (увеличивается с каждым обновлением).
- `versionName` – строка, отображаемая пользователю (например, "1.0.0").

Перед сборкой релизной версии нужно установить актуальные значения.

### 1.5. Подписание приложения и сборка APK/App Bundle
Для публикации в Google Play приложение должно быть подписано цифровой подписью. В Android Studio можно сгенерировать подписанный APK или App Bundle через меню `Build -> Generate Signed Bundle / APK`. Потребуется создать ключ (keystore) и запомнить пароли.

---

## 2. Оборудование и программное обеспечение

- Персональный компьютер с ОС Windows / macOS / Linux.
- Android Studio с любым готовым проектом из предыдущих лабораторных работ (например, приложение для отображения списка постов или парков).
- Эмулятор или реальное устройство для тестирования.

---

## 3. Порядок выполнения работы

### Этап 1. Подготовка проекта (5 мин)

Выберите любой готовый проект из предыдущих лабораторных работ. Убедитесь, что он успешно компилируется и запускается. Можно использовать, например, приложение из лабораторной работы №15 или №19.

### Этап 2. Создание иконки приложения (20 мин)

1. Подготовьте изображение для иконки. Можно скачать бесплатное векторное изображение (например, с [material.io/resources/icons](https://material.io/resources/icons/)) или нарисовать простое в любом графическом редакторе. Для простоты можно использовать текст.
2. В Android Studio откройте проект. Щёлкните правой кнопкой на папке `res` → `New` → `Image Asset`.
3. В открывшемся диалоге:
   - **Icon Type:** выберите `Launcher Icons (Adaptive and Legacy)`.
   - Вкладка **Foreground Layer**:
     - **Source:** выберите `Image` и укажите путь к вашему изображению, или выберите `Clip Art` (например, звёздочку) или `Text`.
     - При необходимости настройте размер и положение (Trim, Resize).
   - Вкладка **Background Layer**:
     - Выберите цвет фона (можно использовать основной цвет вашего приложения).
   - Вкладка **Legacy**:
     - Убедитесь, что сгенерируются иконки для всех плотностей (все галочки установлены).
   - **Res Directory:** оставьте `res` по умолчанию.
4. Нажмите **Next** → **Finish**. Android Studio создаст все необходимые файлы в папках `mipmap-*` и обновит `AndroidManifest.xml`, указав новую иконку через атрибут `android:icon`.

Проверьте манифест: в теге `<application>` должны быть атрибуты:
```xml
android:icon="@mipmap/ic_launcher"
android:roundIcon="@mipmap/ic_launcher_round"
```

Если вы создавали адаптивную иконку, также появится ссылка на `ic_launcher.xml`.

### Этап 3. Запуск и проверка иконки (5 мин)

Запустите приложение на устройстве или эмуляторе. Выйдите на главный экран и найдите иконку вашего приложения. Она должна отображаться с новым дизайном. Для эмулятора с Android 8+ проверьте, что иконка адаптивная (может менять форму в зависимости от настроек лаунчера).

### Этап 4. Добавление экрана-заставки (Splash Screen) (20 мин)

Создадим простую splash-активность, которая будет показываться пару секунд, а затем запускать главную активность.

1. Создайте новый пустой файл разметки `activity_splash.xml` в `res/layout`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/white">

    <ImageView
        android:layout_width="100dp"
        android:layout_height="100dp"
        android:src="@mipmap/ic_launcher"
        android:layout_centerInParent="true"/>

</RelativeLayout>
```

2. Создайте новую Activity `SplashActivity`:

```kotlin
package com.example.yourpackage

import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.os.Looper
import androidx.appcompat.app.AppCompatActivity

class SplashActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_splash)

        Handler(Looper.getMainLooper()).postDelayed({
            startActivity(Intent(this, MainActivity::class.java))
            finish()
        }, 2000) // 2 секунды
    }
}
```

3. В `AndroidManifest.xml` измените главную активность: сделайте `SplashActivity` точкой входа (LAUNCHER), а `MainActivity` уберите из intent-filter.

```xml
<activity
    android:name=".SplashActivity"
    android:exported="true">
    <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
    </intent-filter>
</activity>

<activity
    android:name=".MainActivity"
    android:exported="false" />
```

4. Запустите приложение. Должна появиться заставка с иконкой, затем открыться главный экран.

*Примечание:* Для Android 12+ рекомендуется использовать официальный API `SplashScreen`, но в рамках данной работы достаточно упрощённого варианта.

### Этап 5. Версионирование приложения (5 мин)

Откройте файл `app/build.gradle.kts`. Найдите блок `defaultConfig` и установите версию:

```kotlin
defaultConfig {
    applicationId = "com.example.yourpackage"
    minSdk = 24
    targetSdk = 34
    versionCode = 1
    versionName = "1.0"
}
```

Если вы уже выпускали приложение ранее, увеличьте `versionCode` и измените `versionName`.

### Этап 6. Сборка подписанного APK / App Bundle (20 мин)

1. В меню Android Studio выберите **Build → Generate Signed Bundle / APK**.
2. Выберите `Android App Bundle` (рекомендуется для Google Play) или `APK`.
3. Нажмите **Next**.
4. Если у вас ещё нет ключа подписи, нажмите **Create new...** и заполните поля:
   - Key store path: укажите путь для сохранения файла `.jks`.
   - Password: придумайте пароль.
   - Key alias: имя ключа.
   - Validity (years): 25.
   - Certificate details: заполните хотя бы имя и фамилию.
5. Если ключ уже есть, укажите путь и введите пароли.
6. Нажмите **Next**.
7. Выберите тип сборки `release`, отметьте `V1` и `V2` подписи (должны быть включены по умолчанию).
8. Нажмите **Finish**.

Через некоторое время Android Studio создаст подписанный файл в папке `app/release`. Найдите его и сохраните.

### Этап 7. Тестирование релизной сборки (5 мин)

Установите полученный APK или App Bundle на устройство (можно через `adb install`). Убедитесь, что приложение запускается, иконка отображается корректно.

### Этап 8. Создание иконки для магазина (опционально)

Для публикации в Google Play потребуется также иконка размером 512x512 px (PNG-32). Создайте её отдельно (можно увеличить готовую иконку).

---

## 4. Индивидуальные задания (вариативно)

Выберите одно из заданий для самостоятельной реализации:

1. **Анимированная иконка**  
   Создайте анимированную иконку (для Android 8.0+ можно использовать векторную анимацию). Изучите, как настроить `AnimatedVectorDrawable` для иконки.

2. **Адаптивная иконка с маской**  
   Настройте адаптивную иконку с разными масками для разных устройств (можно использовать свой XML-файл для маски).

3. **Splash Screen по новому API**  
   Реализуйте splash screen с использованием официального API `androidx.core:core-splashscreen` (для Android 12+).

4. **Несколько языков**  
   Добавьте поддержку другого языка (например, английского). Создайте файл `strings.xml` для соответствующей локали.

5. **Подготовка скриншотов для магазина**  
   Создайте набор скриншотов приложения (можно снять на эмуляторе) и краткое описание для публикации в Google Play.

---

## 5. Контрольные вопросы

1. Чем адаптивная иконка отличается от обычной? Какие преимущества она даёт?
2. Какие размеры иконок необходимо подготовить для разных плотностей экрана?
3. Для чего нужен экран-заставка? Как его правильно реализовать?
4. Что такое `versionCode` и `versionName`? Как их правильно обновлять?
5. Какие шаги необходимо выполнить для подписания приложения перед публикацией?

---

## 6. Требования к отчёту

Отчёт должен содержать:
- Титульный лист с названием работы, ФИО, группой.
- Цель работы.
- Скриншот нового дизайна иконки на главном экране устройства.
- Листинг `SplashActivity.kt` и `activity_splash.xml`.
- Скриншот экрана-заставки.
- Скриншот настроек версии в `build.gradle.kts`.
- Краткое описание процесса создания подписанного APK (можно скриншоты диалогов).
- Ответы на контрольные вопросы.
- Вывод по работе.

---

## 7. Возможные ошибки и их решение

- **Иконка не меняется после генерации** – проверьте, что в манифесте указаны правильные ссылки (`@mipmap/ic_launcher`). Выполните `Build -> Clean Project` и перезапустите.
- **Splash Activity запускается, но затем приложение падает** – убедитесь, что в `SplashActivity` правильно указан Intent и что `MainActivity` зарегистрирована в манифесте (даже без intent-filter).
- **Ошибка подписи: "Keystore was tampered with, or password was incorrect"** – проверьте пароли и путь к файлу `.jks`. Возможно, стоит создать новый ключ.
- **App Bundle не устанавливается на устройство** – для установки AAB нужно использовать `bundletool` или загрузить в Google Play. Проще собрать APK для тестирования.

---

**Успешной работы! Поздравляю с завершением курса лабораторных работ!**
